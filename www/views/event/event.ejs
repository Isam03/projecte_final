<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= event.titulo %>
  </title>
  <link rel="icon" type="image/x-icon" href="./Imagenes/profilePic.jpg">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" href="../Sources/prueba.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="./Sources/style.css">
  <link rel="stylesheet" href="../Sources/Profile/profile.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

</head>

<body>


  <!-- Nav Bar -->
  <div class="container position-sticky z-index-sticky top-0">
    <nav
      class="navbar navbar-expand-lg blur top-0 z-index-fixed shadow position-absolute my-3 py-2 start-0 end-0 mx-4 rounded-5"
      style="background-color: #020b1c;opacity: 90%; justify-content: center;">
      <div class="container-fluid">
        <picture>
          <source media="(min-width: 992px)" srcset="./imagenes/Logo2.svg" id="shake">
          <img src="./imagenes/Logo2v2.svg" onclick="audioPlay()" alt="" id="shake"
            style="height: 60px; width: 60px; margin-right: 5px;">

        </picture>
        <img id="logo-bar" src="./Imagenes/LogoBar.svg" alt="" style="height: 50px; margin-right: 5px;">
        <button class="navbar-toggler custom-toggler rounded-5" type="button" data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation" style="padding-left: 20px;">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse nav-underline" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="reveal-text nav-link" id="logo-text"
                style="color: #d38600; font-size:medium;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;"><b>Queda
                  <font style="color: #ff5757;">Ya</font>
                </b></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="linkPagina2">
                <font class="colorText">Crea tu evento</font>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <font class="colorText">FAQ's</font>
              </a>
            </li>
          </ul>
          <form class="d-flex justify-content-center align-items-center" role="search">
            <div class="input-group">
              <input id="searchBar" type="search" class="border-secondary form-control rounded-start-5"
                placeholder="Busca un evento" aria-label="searchBar" aria-describedby="button-addon2"
                style="background-color: #020b1c; color: #c4d7e9;" onkeyup="sendData(this)" disabled>
              <button title="boton" class="btn btn-outline-secondary rounded-end-5" type="submit" id="button-addon2"
                disabled><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-search" viewBox="0 0 16 16">
                  <path
                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg></button>
              <br>

            </div>
          </form>
          <ul class="navbar-nav mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                <img id="profilePic" <% %>
                <% %>
                  src="../Imagenes/profilePic.jpg" alt="">

              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" <% %>
                    href="/profile">


                        <font class="colorText"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16"
                            style="margin-bottom: 5px;">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                            <path fill-rule="evenodd"
                              d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                          </svg>
                        </font>
                  </a></li>
                <li><a class="dropdown-item" href="#">
                    <font class="colorText"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        fill="currentColor" class="bi bi-bag-fill" viewBox="0 0 16 16" style="margin-bottom: 5px;">
                        <path
                          d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5z" />
                      </svg> Compras</font>
                  </a></li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="/logout">
                    
                        <font class="colorText"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16"
                            style="margin-bottom: 5px;">
                            <path fill-rule="evenodd"
                              d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z" />
                            <path fill-rule="evenodd"
                              d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
                          </svg>
                        </font>
                  </a></li>
              </ul>
            </li>
          </ul>


        </div>
      </div>
    </nav>
  </div>
  <!-- END Nav Bar -->

  <div class="m-2">
    <div class="card rounded-3"
      style="position: absolute; top: 50%; left: 5%; width: 90%; height: 900px; opacity: 95%;">
      <div class="card-body rounded-2" id="bodyCard" style="background-color: #010a1b;">
          <h1>
        <font class="rainbow-text p-4">
          <%= event.titulo %>
        </font>
        </h1>
        <div class="container-fluid" style="justify-content: center;">
          <div class="row d-flex gap-4 d-grid bd-highlight flex-wrap">
            <div class="col-md-auto flex-grow-1">
                <div class="card " style="width: auto; height: 0 auto; ">
                    <div class="card-body">
                      <h3 class="card-title" style="text-align: center;">
                        <font>Información</font>
                      </h3>
                      <br>
                      <h6 class="card-subtitle mb-2">Descripcion</h6>
                      <p class="card-text">
                        <font>
                          <%= event.descripcion %> 
                        </font>
                      </p>
                      <h6 class="card-subtitle mb-2">Categoria</h6>
                      <p class="card-text">
                        <font>
                        <% if(categoria != null) { %>
                            <% categoria.forEach(element => { %>
                                <% if (event.id_categoria == element._id) { %>
                                    <%= element.titulo %>
                                <% } %>
                            <% }) %>
                        <% } %>
                        </font>
                      </p>
                      <h6 class="card-subtitle mb-2">Fecha</h6>
                      <p class="card-text">
                        <font>
                        <% 
                        
                        const data = moment(event.fechahora, 'YYYY-DD-MM HH:mm:ss');
                        const formatData = data.format('DD/MM/YYYY');
                        const formatHora = data.format('HH:mm') %>

                          <%= formatData %>
                        </font>
                      </p>
                      <h6 class="card-subtitle mb-2">Hora</h6>
                      <p class="card-text"><%= formatHora %></p>
                      <h6 class="card-subtitle mb-2">Correo de contacto</h6>
                      <p class="card-text">
                        <font>
                          <%= event.correoContacto %>
                        </font>
                      </p>
                      <h6 class="card-subtitle mb-2">Telefono de contacto</h6>
                      <p class="card-text">
                        <font>
                          <%= event.telefonoContacto %>
                        </font>
                      </p>
                      <h6 class="card-subtitle mb-2">Mapa</h6>
                      <% const coord = event.coords.split(',');%>
                      <p class="card-text p-3"><iframe style="border-radius: 2rem;" width="100%" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="<%= "https://www.openstreetmap.org/export/embed.html?bbox=" + coord[1] + "," + coord[0] + "&amp;layer=mapnik" %>"></iframe></p>
                      <h6 class="card-subtitle mb-2">Creado por</h6>
                      <% let creador = "" %>
                      <p class="card-text"><% if(usuario != null) { %>
                        <% usuario.forEach(element => { %>
                            <% if (event.creado_por == element._id) { %>
                                <% creador = element.nombreUsuario; %>
                                <%= creador %>
                            <% } %>
                        <% }) %>
                    <% } %></p>

                    </div>
                  </div>
            </div>
            <div class="col">
                <div class="card" style="width: auto; height: 0 auto;">
                    <div class="card-body">
                      <h5 class="card-title">Pago</h5>
                      <p class="card-text">
                        
                        <div class="d-grid gap-2 text-center">
                            <% if (event.precio == 0) { %>
                                <h1><span class=" end-0 p-2 badge rounded-pill text-warning-emphasis bg-warning-subtle border border-2 border-warning-subtle">
                                    <b>GRATIS</b>
                                    <span class="visually-hidden">Precio</span>
                                </span></h1>
                                
                                <% } else { %>
                                <h1><span class="end-0 p-2 badge rounded-pill text-success-emphasis bg-success-subtle border border-2 border-success-subtle">
                                    <%= event.precio %>€
                                    <span class="visually-hidden">Precio</span>
                                </span></h1>
                            <% } %>
                            <form action="http://localhost:3004/create-checkout-session" method="POST">
                                <input type="hidden" name="referencia" value="<%= "REF" + Math.floor(Math.random() * (999999 - 123456 + 1) + 123456) %>"/>
                                <input type="hidden" name="titulo" value="<%= event.titulo %>"/>
                                <input type="hidden" name="descripcion" value="<%= event.descripcion %>"/>
                                <input type="hidden" name="fecha" value="<%= formatData %>"/>
                                <input type="hidden" name="hora" value="<%= formatHora %>"/>
                                <input type="hidden" name="precio" value="<%= event.precio %>"/>
                                <input type="hidden" name="creado_por" value="<%= creador %>"/>
                                <input type="hidden" name="id_usuario" value="<%= yo._id %>"/>
                                <input type="hidden" name="id_actividad" value="<%= event._id %>"/>
                                <button class="btn btn-info" type="submit">Comprar</button>
                            </form>                              
                        </div>
                      </p>
                      
                    </div>
                  </div>
            </div>
          </div>
            
          
        </div>
      </div>
    </div>
  </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>

  <script>
    const myModal = document.getElementById('modal')
    const myInput = document.getElementById('myInput')

    myModal.addEventListener('shown.bs.modal', () => {
      myInput.focus()
    })</script>

  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
</body>

</html>